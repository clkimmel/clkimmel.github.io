define(["dojo/_base/declare","jimu/BaseWidget","dojo/dom-style","dojo/html","jimu/LayerInfos/LayerInfos","jimu/dijit/ItemSelector","dojo/_base/lang","dijit/_WidgetsInTemplateMixin","jimu/loaderplugins/jquery-loader!//code.jquery.com/jquery-1.11.0.min.js"],function(n,t,i,r,u,f,e){return n([t],{OB_WEB_API_FILENAME:"/OB_WebAPI.min.js",OB_VIEWMODEL_FILENAME:"/OBWidgetViewModel.min.js",OB_VERSIONAGENT_FILENAME:"/OBVersionAgent.min.js",CONFIG_PROP_SERVICEURL:"obServiceUrl",CONFIG_PROP_PORTALSERVICEURL:"portalWidgetUrl",baseClass:"jimu-widget-OnBase",versionStampQueryString:"",wScope:null,obApiJSpath:null,portalWidgetJSPath:"",obApiViewModel:null,useWABSelectToolAutoUpdate:!1,postCreate:function(){u.getInstance(this.map,this.map.itemInfo).then(e.hitch(this,function(n){this.layerInfos=n}))},startup:function(){this.inherited(arguments);wScope=this;wScope.obApiJSpath=this.config.obJS_API_Path.replace(/\/$/,"");wScope.portalWidgetJSPath=wScope.config[wScope.CONFIG_PROP_PORTALSERVICEURL];wScope.portalWidgetJSPath!==null&&wScope.portalWidgetJSPath!==""&&(wScope.portalWidgetJSPath=wScope.portalWidgetJSPath.replace(/\/$/,""),console&&console.log("Portal Widget URL used from: '"+wScope.portalWidgetJSPath+"'"),wScope.obApiJSpath=wScope.portalWidgetJSPath);wScope.useWABSelectToolAutoUpdate=this.config.useWABSelectToolAutoUpdate;wScope.setWidgetInstanceAsync().then(function(){wScope.obApiViewModel.checkSessionAsync()})},createObApiAndObViewModelAsync:function(){var n=$.Deferred(),i=wScope.obApiJSpath+wScope.OB_WEB_API_FILENAME+wScope.versionStampQueryString,r=wScope.obApiJSpath+wScope.OB_VIEWMODEL_FILENAME+wScope.versionStampQueryString;try{require([i,r],function(t,i){var r=new t(wScope.config[wScope.CONFIG_PROP_SERVICEURL],!0,!1);r.getInstanceAsync().then(function(t){t.createWidgetAsync(wScope.map,i).then(function(t){wScope.obApiViewModel=t;wScope.useWABSelectToolAutoUpdate&&(wScope.obApiViewModel.restrictAutoQueryingForResults(!1),wScope.obApiViewModel.setBypassConfigLayerCheck(!0));n.resolve(t)})})})}catch(t){console&&console.error("OnBase: An exception occurred creating the obApi and/or widget viewmodel. "+t.message);n.reject(t.message)}return n},getVersionAgentAndSetStampAsync:function(){var n=$.Deferred();try{require([wScope.obApiJSpath+wScope.OB_VERSIONAGENT_FILENAME],function(t){t.getVersionStampQueryStringAsync(wScope.config[wScope.CONFIG_PROP_SERVICEURL]).then(function(n){wScope.versionStampQueryString=n}).fail(function(n){console&&console.error("OnBase: An error occurred calling getVersionStampQueryStringAsync. "+n)}).always(function(){n.resolve()})})}catch(t){console&&console.error("OnBase: An exception occurred getting the version stamp. "+t.message);n.resolve()}return n},setWidgetInstanceAsync:function(){return wScope.getVersionAgentAndSetStampAsync().then(wScope.createObApiAndObViewModelAsync)}})});